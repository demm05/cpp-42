#include <algorithm>
#include <bits/stdc++.h>
#include <iterator>

int depth = 0;

void printVec(std::vector<int> const &v, std::string const &name,
              int depth = 0) {
    std::cout << depth << ": " << name << ": ";
    for (size_t i = 0; i < v.size(); i++) {
        std::cout << v[i] << " ";
    }
    std::cout << std::endl;
}

void copy_pair(std::vector<int>::iterator position, std::vector<int> &v,
               size_t pair, size_t group_size) {
    size_t pair_size = group_size / 2;
    std::copy(pair * pair_size, pair + pair_size + pair_size, position);
}

void rmis(std::vector<int> &items, size_t group_size = 2) {
    depth++;
    if (group_size > items.size() || items.size() < 1) {
        return;
        depth--;
    }
    size_t pair_size = group_size / 2;
    for (size_t i = pair_size - 1; i + pair_size < items.size();
         i += group_size) {
        size_t b_i = i;
        size_t a_i = b_i + pair_size;
        if (items[a_i] < items[b_i]) {
            size_t from = b_i + 1;
            size_t to = a_i + 1;
            size_t starting = b_i - (pair_size - 1);
            /*{
                std::cout << "swapping from " << from << "(" << items[from]
                          << ") - " << to << "(" << items[to]
                          << ") starting at: " << starting << "("
                          << items[starting] << ")" << std::endl;
            }*/
            std::swap_ranges(items.begin() + from, items.begin() + to,
                             items.begin() + starting);
        }
    }
    rmis(items, group_size * 2);
    printVec(items, "items", depth);
    depth--;
    std::vector<int> main;
    std::vector<int> pend;
    main.reserve(items.size());
    pend.reserve(items.size() / 2);
    copy_pair(main.begin(), items, 0, group_size);
    for (size_t i = 1; i < items.size() / pair_size; i++) {
        if (i % 2)
            copy_pair(main.)
    }
    for (size_t i = pair_size - 1; i + pair_size < items.size();
         i += group_size) {
        size_t b_start = i - (pair_size - 1);
        size_t b_end = i;
        size_t a_start = i + 1;
        size_t a_end = a_start + pair_size;
        main.insert(main.begin(), items.begin() + a_start,
                    items.begin() + a_end);
        pend.insert(pend.begin(), items.begin() + b_start,
                    items.begin() + b_end);
    }
    printVec(main, "main", depth);
    printVec(pend, "pend", depth);
}

void merge_insert_sort(std::vector<int> &items) {
    depth++;
    if (items.size() < 2) {
        return;
        depth--;
    }
    std::vector<int> main;
    std::vector<int> pend;
    main.reserve(items.size());
    pend.reserve(items.size() / 2);
    for (size_t i = 0; i < items.size() - 1; i += 2) {
        if (items[i] > items[i + 1]) {
            main.push_back(items[i]);
            pend.push_back(items[i + 1]);
        } else {
            main.push_back(items[i + 1]);
            pend.push_back(items[i]);
        }
    }
    printVec(main, "main");
    printVec(pend, "pend");
    merge_insert_sort(main);
    depth--;
}

int main(void) {
    std::vector<int> res = {11, 2,  17, 0,  16, 8,  6, 15, 10, 3,  21,
                            1,  18, 9,  14, 19, 12, 5, 4,  20, 13, 7};
    rmis(res);
    // merge_insert_sort(res);
}
